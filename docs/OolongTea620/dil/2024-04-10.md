# 11장 뉴스 피드백 설치

## 1단계 - 문제 이해 및 설계 범위 확정

책에서의 뉴스피드 시스템은 이런 요구사항을 만족시켜야 한다.

```
- 모바일 / 웹 둘 다 지원 가능
- 사용자는 뉴스 피드 페이지에 새로운 스토리를 올릴 수 있어야 한다.
- 친구들이 올리는 스토리를 볼 수 있어야 한다.
- 최신 흐름 역순으로 가정
- 한 명의 사용자는 5000명과 친구를 맺을 수 있음
- 트래픽 규모 : 10,000,000 DAU
- 피드에는 이미지, 비디오 등의 미디어 파일이 포함 될 수 있음
```

## 2단계 - 개략적인 설계안 제시 및 동의 구하기

```
(1) 뉴스 피드 발행(feed publishing):

   사용자가 스토를 포스팅하면 해당 데이터를 캐시와 데이터베이스에 기록.
   새 포스팅은 친구의 뉴스 피드에도 전송됨

(2) 뉴스 피드 생성(new feed building)

   뉴스 피드는 모든 친구의 포스팅을 시간 흐름의 역순으로 모아서 만든다고 가정
```

### 1. 뉴스 피드 API

HTTP 프로토콜 기반, 상태 정보를 업그레이드 하거나, 뉴스 피드를 가져오거나, 친구를 추가하는 등 다양한 작업을 수행하는데 사용됨.

#### 피드 발행 API

새 스토리를 포스팅하기 위한 API HTTP 형태로 요청을 보내면 됨.

```
POST /v1/me/feed

header
Authorization 헤더

인자
body : 포스팅 내용
```

#### 피드 읽기 API

```
GET /v1/me/feed

header 
Authorization 헤더
```

### 2. 뉴스 생성 API

- 사용자 : 뉴스 피드를 읽는 주체   
- 로드 벨런서 : 트래픽을 웹 서버들로 분산   
- 웹 서버 : 트래픽을 뉴스피드 서비스로 보낸다   
- 뉴스 피드 서비스 : 캐시에서 뉴스 피드 서비스를 가져오는 서비스
- 뉴스 피드 캐시 : 뉴스피드를 렌더링 할 때, 필요한 피드 ID를 보관

## 3단계 - 상세 설계

### 피드 흐름 상세 설계

#### 웹 서버

- 올바른 인증 토큰을 Authorization 헤더의 넣고, API를 호출하는 사용자만 포스팅 가능해야 한다.
- 특정 기간 동안 한 사용자가 올릴 수 있는 포스팅 수의 제한을 두어야 한다.

#### 포스팅 전송(팬아웃)서비스

`팬아웃` : 어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정

#### 쓰기 시점 팬아웃

#### 읽기 시점 팬아웃
