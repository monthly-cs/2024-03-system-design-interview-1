# 13장 검색어 자동완성 시스템

## 1단계 - 문제 이해 및 설계 범위 예시

```
- 자동 완성되는 단어는 사용자가 입력하는 단어의 첫 부분으로 한정
- 5개의 자동완성 검색어 표시
- 질의 빈도에 따라서 자동완성 검색어 표시
- 질의는 영어, 시간이 허락하면 외국어 지원도 생각
- 모든 질의는 영어 소문자로 한정
- DAU 기준 1000만명
```

### 요구사항

- 빠른 응답 속도 : 사용자가 검색어 입력함에 따라서 자동완성 검색어도 충분히 빨리 표시되어야.(100ms 이내)
- 연관성 : 자동완성되어 출력되는 검색어는 사용자가 입력한 단어와 연관된 것.
- 정렬 : 시스템의 계산 결과는 인기도(popularity) 등의 **순위 모델에 의해서 정렬되어 있어야** 한다.
- 규모 확장성 : 시스템은 많은 트래픽을 감당할 수 있도록 확장 가능해야 한다.
- 고가용성 : 시스템 일부에 장애가 발생 or 느려지거나, 예상치 못한 네트워크 문제가 생겨도 시스템은 계속 사용 가능해야 한다.

### 개략적 규모 추정

- DAU : 1000만명 이상
- 한 사용자는 평균적으로 매일 10건의 검색을 수행한다고 가정
- 질의 할 때 마다, 평균적으로 20byte의 데이터를 입력한다고 가정
  - 문자 인코딩으로 ASCII 사용(1문자 1byte)
  - 질의문은 평균적으로 4개 단어로 이루어진다고 가정, 각 단어는 평균적으로 다섯 글자로 구성된다고 가정.
  - 질의당 평균적으로 4 X 5 = 20 byte이다.
- 검색창에 글자를 입력할 때 마다, 클라이언트는 검색어 자동완성 요청을 백엔드에 보낸다.
    - 평균적으로 1회 검색 당 20회 요청이 백엔드로 전달.
- 대략 초당 24,000건의 질의(QPS)가 발생, 총 `10,000,000 사용자 X 10질의 / 일 X 20자 / 24시간 / 3600초`
- `최대 QPS = QPS X 2 = 48,000`
- 질의 가운데 20% 정도는 신규 검색어라고 가정, 0.4GB씩 신규데이터가 시스템에 추가됨 
  - (= 10,000,000 사용자  X 10 질의 / 일 X 20자 X 20%) 
  

## 2단계 - 개략적인 설계안 제시 및 동의 구하기

- 데이터 수집 서비스(data gathering service):
  - 사용자가 입력한 질의를 실시간으로 수집하는 서비스

- 질의 서비스(query service):
  - 주어진 질의에 다섯개의 인기 검색어를 정렬해 놓는 서비스

### 데이터 수집 서비스



### 질의 서비스

- query : 질의문을 저장허는 필드
- frequency : 질의문이 사용된 빈도를 저장하는 필드

## 3단계 - 상세 설게

- 트라이 자료구조
- 데이터 수집 서비스
- 질의 서비스

### 트라이 자료구조


### 데이터 수집 서비스

### 질의 서비스